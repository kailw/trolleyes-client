<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en" ng-app="MyApp">
    <head>
        <title>Trolleyes</title>
        <link rel="shortcut icon" href="#">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">        
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link href="css/main.css" rel="stylesheet" type="text/css"/>
        <link href="css/mio.css" rel="stylesheet" type="text/css"/>
    </head>

    <body ng-controller="MyController">
    <header ng-include="'header.html'"></header>
    <main role="main" class="container">
        <div class="row primeraParte">
            <div class="col-7">
                <h4>Número de productos a generar en la base de datos :</h4> 
            </div>
            <div class="col-2">
                <input type="text" class="form-control" ng-model="numeroInsertar">
            </div>
            <div class="col-1">
                <button ng-click="crearProductos()" type="button" class="btn btn-success">Enviar</button>
            </div> 
            <div class="col-2">
                <button ng-click="limpiar()" type="reset"class="btn btn-danger">Limpiar</button>
            </div>
        </div>             
        <h3 class="{{cssAlertSuccessUno}} mensaje">{{jsonMensajesProductos1}} </h3>
        <div class="row segundaParte">
            <div class="col-4">
                <h4>Número de registros por página :</h4> 
            </div>
            <div class="col-2">
                <!--                <input type="text" class="form-control" ng-model="numeroRegistrosPagina">-->                        
                <select class="custom-select" ng-model="numeroRegistrosPagina">
                    <option selected value="5">5</option>
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>                        
            </div>
            <div class="col-3">
                <h4>Página a mostrar :</h4> 
            </div>
            <div class="col-1">
                <input type="text" class="form-control" ng-model="numeroPagina">
            </div>
            <div class="col-2">
                <button ng-click="mostrarProductos()" class="btn btn-info">Mostrar Productos</button>
            </div>

        </div>
        <h3 class="{{cssAlertSuccessDos}} mensaje">{{jsonMensajesProductos2}} </h3>
        <div class="terceraParte">
            <table class="table table-striped table-hover">
                <caption>Lista de Productos</caption
                <tr class="alineacion">
                    <th>ID</th>
                    <th>CÓDIGO</th>
                    <th>DESCRIPCIÓN</th>
                    <th>EXISTENCIAS</th>
                    <th>PRECIO</th>
                    <th>FOTO</th>
                    <th>ID_TIPOPRODUCTO</th>
                </tr>
                <tr ng-show="ocultarProductos" ng-repeat="producto in jsonProductos">
                    <th class="alineacion">{{producto.id}}</th>
                    <td>{{producto.codigo}}</td>
                    <td>{{producto.desc}}</td>
                    <td>{{producto.existencias}}</td>
                    <td>{{producto.precio}} €</td>
                    <td>{{producto.foto}}</td>
                    <td>{{producto.id_tipoProducto}}</td>                
                </tr>
            </table> 

        </div>

        <div class="row">
            <div class="col-3 mx-auto">
                <nav aria-label="Page navigation example">
                    <ul class="pagination">
                        <li ng-class="activeItem" ng-repeat="num in array" ng-click="loadTablePage(num)">
                            <a class="page-link" href="#" ng-click="paginationClick(num)">{{num}}</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

    </main>
    <footer class="footer" ng-include="'footer.html'"></footer>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
    <script>
                var MyModule = angular.module('MyApp', []);
                MyModule.controller("MyController", ["$scope", "$http", function ($scope, $http) {
                        $scope.limpiar = function () {
                            $scope.numeroInsertar = "";
                            $scope.numeroPagina = "";
                            $scope.numeroRegistrosPagina = "";
                            $scope.cssAlertSuccessUno = "";
                            $scope.cssAlertSuccessDos = "";
                            $scope.jsonMensajesProductos1 = "";
                            $scope.jsonMensajesProductos2 = "";
                            $scope.jsonProductos = "";
                        }


                        $scope.crearProductos = function () {
                            $scope.cssAlertSuccessUno = "alert alert-success",
                                    $http({
                                        method: "GET",
                                        withCredential: true,
                                        url: "http://localhost:8080/trolleyes/json?ob=producto&op=fill&numero=" + $scope.numeroInsertar
                                    }).then(function (response) {
                                $scope.status = response.status;
                                if ($scope.numeroInsertar == 1) {
                                    $scope.jsonMensajesProductos1 = "Se ha creado " + $scope.numeroInsertar + " producto nuevo."
                                } else {
                                    $scope.jsonMensajesProductos1 = "Se han creado " + $scope.numeroInsertar + " productos nuevos."
                                }
                            }, function (response) {
                                $scope.cssAlertSuccessUno = "alert alert-danger"
                                $scope.jsonMensajesProductos1 = "Debes introducir al menos un número";
                                $scope.status = response.status;
                            });
                        }

                        $scope.mostrarProductos = function () {
                            $scope.ocultarProductos = true,
                                    $http({
                                        method: "GET",
                                        withCredential: true,
                                        url: "http://localhost:8080/trolleyes/json?ob=producto&op=getpage&rpp=" + $scope.numeroRegistrosPagina + "&page=" + $scope.numeroPagina
                                    }).then(function (response) {
                                $scope.status = response.status;
                                $scope.jsonProductos = response.data.message;
                            }, function (response) {
                                $scope.cssAlertSuccessDos = "alert alert-danger"
                                $scope.jsonMensajesProductos2 = "Debes introducir al menos un número";
                                $scope.status = response.status;
                            });
                        }




                        //                        $scope.activar = true;
                        //                        $scope.ajaxData = "";
                        //                        $scope.toggle = function () {
                        //                            $scope.mostrar = !$scope.mostrar;
                        //                        }
                        //                        $scope.enable = function () {
                        //                            $scope.activar = !$scope.activar;
                        //                        }
                        //                        $scope.usuarios = function () {
                        //                            $http({
                        //                                method: 'GET',
                        //                                withCredentials: true,
                        //                                contentType: 'application/x-www-form-urlencoded;charset=UTF-8',
                        //                                url: 'http://localhost:8080/trolleyes/json?ob=producto&op=getpage&rpp=10&page=1'
                        //                            }).then(function (response) {
                        //                                $scope.status = response.status;
                        //                                $scope.ajaxDataUsuarios = response.data.message;
                        //                            }, function (response) {
                        //                                $scope.ajaxDataUsuarios = response.data.message || 'Request failed';
                        //                                $scope.status = response.status;
                        //                            });
                        //                        }
                        //                        $http({
                        //                            method: 'POST',
                        //                            withCredentials: true,
                        //                            dataType: 'text',
                        //                            url: 'http://localhost:8080/trolleyes/json?ob=producto&op=get&id=10',
                        //                            contentType: 'application/x-www-form-urlencoded'
                        //                        }).then(function (response) {
                        //                            $scope.status = response.status;
                        //                            $scope.ajaxData = response.data.message;
                        //
                        //                        }, function (response) {
                        //                            $scope.ajaxData = response.data.message || 'Request failed';
                        //                            $scope.status = response.status;
                        //                        });
                    }]);

    </script>
</body>
</html>
